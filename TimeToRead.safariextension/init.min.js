"use strict";function minutesToHrs(e){var t=Math.round(e);if(1>=t)return"About a minute.";if(t>=60){var n=Math.trunc(t/60),i=t%60;1===(""+i).length&&(i="0"+i);var o=1===n?" hour":" hours";return 0!==i?n+":"+i+o:n+o}return t+" mins."}function createReadingTimeElement(e){var t=document.createElement("reading-time");return t.className="Reading-elapsed-time",t.innerText=e,t.onmouseover=function(){this.textContent="Close"},t.onmouseout=function(){this.textContent=e},t.onclick=function(){document.body.removeChild(t)},t}function getWordsInArticle(e){var t=e.split(" ");return t.filter(function(e){return"\n"!==e?e:void 0})}function getArticle(){var e=document.location,t={spec:e.href,host:e.host,prePath:e.protocol+"//"+e.host,scheme:e.protocol.substr(0,e.protocol.indexOf(":")),pathBase:e.protocol+"//"+e.host+e.pathname.substr(0,e.pathname.lastIndexOf("/")+1)};return new Readability(t,document.cloneNode(!0)).parse()}function timeToRead(e,t){var n=getWordsInArticle(e),i=n.length,o=i/t;return minutesToHrs(o)}function render(){var e=60,t=window.self!==window.top||null!==window.frameElement;if(!t){safari.self.tab.dispatchMessage("getWMP");var n=getArticle(),i=function(t){switch(t.name){case"wmpValue":e=t.message,document.body.appendChild(createReadingTimeElement(timeToRead(n.textContent,e)));break;case"wmpUpdated":e=t.message;var i=document.getElementsByTagName("reading-time")[0];i.innerText=timeToRead(n.textContent,e)}};n&&safari.self.addEventListener("message",i,!1)}}function onVisibilityChange(){"visible"===document.visibilityState&&visible===!1&&(visible=!0,render())}var visible="visible"===document.visibilityState;visible&&render(),document.addEventListener("visibilitychange",onVisibilityChange,!1);